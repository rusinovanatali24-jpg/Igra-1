<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –∏–≥—Ä—ã "–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏" PRO</title>
    <style>
        /* –°—Ç–∏–ª–∏ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ —É–ª—É—á—à–µ–Ω–∏—è–º–∏ –¥–ª—è –º–µ—Ç–æ–∫ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 40px; text-align: center; }
        .tabs { display: flex; background: #f5f5f5; border-bottom: 2px solid #ddd; }
        .tab { flex: 1; padding: 20px; text-align: center; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: all 0.3s ease; border: none; background: transparent; color: #666; }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }
        .tab-content { padding: 40px; display: none; }
        .tab-content.active { display: block; }
        .section { margin-bottom: 30px; padding: 25px; background: #f9f9f9; border-radius: 12px; border-left: 5px solid #667eea; }
        .section-title { font-size: 1.4em; margin-bottom: 20px; color: #333; display: flex; align-items: center; gap: 10px; }
        
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        input[type="text"], input[type="number"], select, textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; }

        .theme-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .theme-card { padding: 15px; border: 3px solid #eee; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; background: white; }
        .theme-card.selected { border-color: #667eea; background: #f0f4ff; }

        /* –ö–∞—Ä—Ç–∞ –∏ –ú–µ—Ç–∫–∏-–≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏ */
        .map-editor { position: relative; width: 100%; height: 600px; border: 4px solid #8b4513; border-radius: 15px; background-size: cover; background-position: center; background-color: #ddd; }
        .map-point-editor { position: absolute; width: 40px; height: 40px; cursor: move; transform: translate(-50%, -100%); filter: drop-shadow(0 4px 5px rgba(0,0,0,0.4)); }
        .map-point-number { position: absolute; top: 7px; left: 50%; transform: translateX(-50%); color: white; font-weight: bold; font-size: 12px; z-index: 2; }
        
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-success { background: #27ae60; color: white; }
        .btn-primary { background: #667eea; color: white; }
        .btn-danger { background: #e74c3c; color: white; }

        .answer-item { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; background: white; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
        .iframe-container { background: #2d3436; color: #00d4ff; padding: 15px; border-radius: 10px; font-family: monospace; font-size: 0.9em; margin-top: 10px; word-break: break-all; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ –†–µ–¥–∞–∫—Ç–æ—Ä "–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏"</h1>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="tab" onclick="switchTab(1)">‚ùì –í–æ–ø—Ä–æ—Å—ã</button>
            <button class="tab" onclick="switchTab(2)">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
            <button class="tab" onclick="switchTab(3)">üëÅÔ∏è –ü—Ä–µ–≤—å—é –∏ –ö–æ–¥</button>
        </div>

        <div class="tab-content active">
            <div class="section">
                <h2 class="section-title">–¢–µ–º–∞ –∏–≥—Ä—ã</h2>
                <div class="theme-selector" id="themeSelector"></div>
            </div>
            <div class="section">
                <h2 class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
                <div class="settings-grid">
                    <div class="form-group"><label>–ü–æ–ø—ã—Ç–æ–∫</label><select id="maxAttempts"><option value="3">3 –ø–æ–ø—ã—Ç–∫–∏</option><option value="999">‚àû –ë–µ–∑–ª–∏–º–∏—Ç</option></select></div>
                    <div class="form-group"><label>–¢–∞–π–º–µ—Ä (—Å–µ–∫)</label><input type="number" id="timerDuration" value="30"></div>
                </div>
            </div>
            <div class="section">
                <h2 class="section-title">–§–∏–Ω–∞–ª –∏ –ù–∞–≥—Ä–∞–¥–∞</h2>
                <div class="settings-grid">
                    <div class="form-group">
                        <label>–¢–∏–ø –Ω–∞–≥—Ä–∞–¥—ã</label>
                        <select id="finalReward">
                            <option value="treasure">üè¥‚Äç‚ò†Ô∏è –°—É–Ω–¥—É–∫</option>
                            <option value="medal">üèÖ –ú–µ–¥–∞–ª—å</option>
                            <option value="trophy">üèÜ –ö—É–±–æ–∫</option>
                            <option value="crystal">üíé –ö—Ä–∏—Å—Ç–∞–ª–ª</option>
                        </select>
                    </div>
                    <div class="form-group"><label>–¢–µ–∫—Å—Ç –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è</label><input type="text" id="finalMessage" value="–£—Ä–∞! –°–æ–∫—Ä–æ–≤–∏—â–∞ –≤–∞—à–∏!"></div>
                </div>
            </div>
        </div>

        <div class="tab-content">
            <div class="section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 class="section-title">–í–æ–ø—Ä–æ—Å—ã</h2>
                    <button class="btn btn-success" onclick="addQuestion()">+ –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
                </div>
                <div id="questionsList"></div>
            </div>
        </div>

        <div class="tab-content">
            <div class="section">
                <h2 class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ä—Ç—ã</h2>
                <div style="margin-bottom:15px; display:flex; gap:10px;">
                    <button class="btn btn-primary" onclick="document.getElementById('mapUpload').click()">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ—é –∫–∞—Ä—Ç—É</button>
                    <input type="file" id="mapUpload" hidden accept="image/*" onchange="handleMapUpload(event)">
                </div>
                <div class="map-editor" id="mapEditor"></div>
            </div>
        </div>

        <div class="tab-content">
            <div class="section">
                <h2 class="section-title">–ö–æ–¥ –¥–ª—è Genially</h2>
                <div class="iframe-container" id="geniallyCode"></div>
                <button class="btn btn-primary" style="margin-top:10px;" onclick="copyIframe()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
            </div>
            <div style="text-align:center; padding:20px;">
                <button class="btn btn-success" onclick="exportGame()" style="font-size:1.2em; padding:20px 50px;">üíæ –°–∫–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤—É—é –∏–≥—Ä—É (.html)</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        var editorData = {
            theme: 'pirates',
            customMap: null,
            questions: [],
            mapPoints: []
        };

        // –¢–≤–æ–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã —Å—é–¥–∞
        const themes = [
            {id:'pirates', name:'–ü–∏—Ä–∞—Ç—ã', icon:'üè¥‚Äç‚ò†Ô∏è', img:'https://raw.githubusercontent.com/fshv-dev/treasure-assets/main/pirates_map.jpg'},
            {id:'space', name:'–ö–æ—Å–º–æ—Å', icon:'üöÄ', img:'https://raw.githubusercontent.com/fshv-dev/treasure-assets/main/space_map.jpg'},
            {id:'jungle', name:'–î–∂—É–Ω–≥–ª–∏', icon:'üå¥', img:'https://raw.githubusercontent.com/fshv-dev/treasure-assets/main/jungle_map.jpg'},
            {id:'underwater', name:'–ú–æ—Ä–µ', icon:'üê†', img:'https://raw.githubusercontent.com/fshv-dev/treasure-assets/main/underwater_map.jpg'},
            {id:'city', name:'–ì–æ—Ä–æ–¥', icon:'üèôÔ∏è', img:'https://img.freepik.com/free-vector/city-skyline-concept-illustration_114360-892.jpg'}
        ];

        function switchTab(index) {
            document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab')[index].classList.add('active');
            document.querySelectorAll('.tab-content')[index].classList.add('active');
            if(index === 2) updateMapPoints();
            if(index === 3) generateGeniallyCode();
        }

        function renderThemes() {
            const container = document.getElementById('themeSelector');
            container.innerHTML = themes.map(t => `
                <div class="theme-card ${t.id === editorData.theme ? 'selected' : ''}" onclick="selectTheme('${t.id}')">
                    <div style="font-size:2.5em">${t.icon}</div>
                    <div style="font-weight:bold">${t.name}</div>
                </div>
            `).join('');
        }

        function selectTheme(id) {
            editorData.theme = id;
            editorData.customMap = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–≤–æ—é –∫–∞—Ä—Ç—É –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç–µ–º—ã
            renderThemes();
            updateMapDisplay();
        }

        function updateMapDisplay() {
            const map = document.getElementById('mapEditor');
            if(editorData.customMap) {
                map.style.backgroundImage = `url('${editorData.customMap}')`;
            } else {
                const theme = themes.find(t => t.id === editorData.theme);
                map.style.backgroundImage = `url('${theme.img}')`;
            }
        }

        function handleMapUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    editorData.customMap = e.target.result;
                    updateMapDisplay();
                };
                reader.readAsDataURL(file);
            }
        }

        // –õ–æ–≥–∏–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ (–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ –ø—Ä–æ—Å—å–±–µ)
        function addQuestion() {
            const q = { id: Date.now(), text: '–í–æ–ø—Ä–æ—Å...', type: 'single', answers: [{id: 1, text: '–û—Ç–≤–µ—Ç', correct: true}] };
            editorData.questions.push(q);
            renderQuestions();
        }

        function renderQuestions() {
            const container = document.getElementById('questionsList');
            container.innerHTML = editorData.questions.map((q, idx) => `
                <div class="section" style="background:white; border: 1px solid #ddd;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <b>‚Ññ${idx+1}</b>
                        <button class="btn-danger" onclick="deleteQuestion(${q.id})">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    <input type="text" value="${q.text}" onchange="updateQText(${q.id}, this.value)" style="margin-bottom:10px;">
                    <select onchange="updateQType(${q.id}, this.value)" style="margin-bottom:10px;">
                        <option value="single" ${q.type==='single'?'selected':''}>–û–¥–∏–Ω –æ—Ç–≤–µ—Ç</option>
                        <option value="multiple" ${q.type==='multiple'?'selected':''}>–ù–µ—Å–∫–æ–ª—å–∫–æ</option>
                        <option value="text" ${q.type==='text'?'selected':''}>–í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞</option>
                    </select>
                    <div id="ans_${q.id}">
                        ${q.answers.map(a => `
                            <div class="answer-item">
                                <input type="checkbox" ${a.correct?'checked':''} onchange="toggleCorrect(${q.id}, ${a.id})">
                                <input type="text" value="${a.text}" onchange="updateAText(${q.id}, ${a.id}, this.value)">
                                <button onclick="removeAns(${q.id}, ${a.id})">‚úï</button>
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn btn-secondary" onclick="addAns(${q.id})">+ –û—Ç–≤–µ—Ç</button>
                </div>
            `).join('');
        }

        function updateQText(id, v) { editorData.questions.find(q=>q.id===id).text = v; }
        function deleteQuestion(id) { editorData.questions = editorData.questions.filter(q=>q.id!==id); renderQuestions(); }
        function addAns(qId) { editorData.questions.find(q=>q.id===qId).answers.push({id:Date.now(), text:'', correct:false}); renderQuestions(); }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–∫ (–ì–µ–æ–ø–æ–∑–∏—Ü–∏—è)
        function updateMapPoints() {
            const map = document.getElementById('mapEditor');
            const count = editorData.questions.length;
            
            while(editorData.mapPoints.length < count) {
                editorData.mapPoints.push({id: editorData.mapPoints.length+1, x: 50, y: 50});
            }
            editorData.mapPoints = editorData.mapPoints.slice(0, count);

            map.innerHTML = editorData.mapPoints.map(p => `
                <div class="map-point-editor" id="pt_${p.id}" style="left:${p.x}%; top:${p.y}%;" onmousedown="startDrag(event, ${p.id})">
                    <span class="map-point-number">${p.id}</span>
                    <svg viewBox="0 0 24 24" fill="#e74c3c"><path d="M12 0C7.58 0 4 3.58 4 8c0 5.25 7 13 8 14 1-1 8-8.75 8-14 0-4.42-3.58-8-8-8zm0 11c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/></svg>
                </div>
            `).join('');
        }

        function startDrag(e, id) {
            const rect = document.getElementById('mapEditor').getBoundingClientRect();
            document.onmousemove = (ev) => {
                let x = ((ev.clientX - rect.left) / rect.width) * 100;
                let y = ((ev.clientY - rect.top) / rect.height) * 100;
                const p = editorData.mapPoints.find(p=>p.id===id);
                p.x = Math.max(2, Math.min(98, x));
                p.y = Math.max(5, Math.min(98, y));
                const el = document.getElementById(`pt_${id}`);
                el.style.left = p.x + '%'; el.style.top = p.y + '%';
            };
            document.onmouseup = () => document.onmousemove = null;
        }

        function generateGeniallyCode() {
            const iframe = `<iframe src="https://your-hosting.com/play?data=${btoa(JSON.stringify(editorData))}" width="100%" height="600" frameborder="0"></iframe>`;
            document.getElementById('geniallyCode').innerText = iframe;
        }

        function exportGame() {
            if(editorData.questions.length === 0) return alert("–î–æ–±–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å—ã!");
            const html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ò–≥—Ä–∞</title></head><body><script>const data = ${JSON.stringify(editorData)};<\/script><h1>–î–≤–∏–∂–æ–∫ –∏–≥—Ä—ã —Å–∫–æ—Ä–æ —Ç—É—Ç...</h1></body></html>`;
            const blob = new Blob([html], {type: "text/html;charset=utf-8"});
            saveAs(blob, "treasure-hunt.html");
        }

        window.onload = () => { renderThemes(); selectTheme('pirates'); addQuestion(); };
    </script>
</body>
</html>
