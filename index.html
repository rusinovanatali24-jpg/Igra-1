<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –∏–≥—Ä—ã "–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏" PRO</title>
    <style>
        /* –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∞—à–∏ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 40px; text-align: center; }
        .tabs { display: flex; background: #f5f5f5; border-bottom: 2px solid #ddd; }
        .tab { flex: 1; padding: 20px; text-align: center; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: all 0.3s ease; border: none; background: transparent; color: #666; }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }
        .tab-content { padding: 40px; display: none; }
        .tab-content.active { display: block; }
        .section { margin-bottom: 40px; padding: 25px; background: #f9f9f9; border-radius: 10px; border-left: 4px solid #667eea; }
        .section-title { font-size: 1.5em; margin-bottom: 20px; color: #333; display: flex; align-items: center; gap: 10px; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π */
        .theme-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        .theme-card { padding: 15px; border: 3px solid #ddd; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; background: white; }
        .theme-card.selected { border-color: #667eea; background: #f0f4ff; }
        
        /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞ */
        .map-editor { 
            position: relative; 
            width: 100%; 
            height: 500px; 
            border: 5px solid #8b4513; 
            border-radius: 15px; 
            background-size: cover; 
            background-position: center;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.2);
        }
        
        /* –ú–∞—Ä–∫–µ—Ä –ì–µ–æ–ø–æ–∑–∏—Ü–∏–∏ */
        .map-point-editor {
            position: absolute;
            width: 40px;
            height: 40px;
            cursor: move;
            transform: translate(-50%, -100%); /* –ö–æ–Ω—á–∏–∫ –∏–∫–æ–Ω–∫–∏ –≤ —Ç–æ—á–∫–µ –∫–ª–∏–∫–∞ */
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.4));
            transition: transform 0.1s;
        }
        .map-point-editor svg { width: 100%; height: 100%; }
        .map-point-number {
            position: absolute;
            top: 8px; left: 50%;
            transform: translateX(-50%);
            color: white; font-weight: bold; font-size: 12px;
            text-shadow: 1px 1px 2px black;
        }

        .answer-item { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .iframe-container { background: #333; color: #a8e063; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9em; margin-top: 10px; word-break: break-all; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-success { background: #56ab2f; color: white; }
        .btn-danger { background: #eb3349; color: white; }
        .btn-secondary { background: #eee; color: #333; }
        
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Treasure Hunt Game Editor</h1>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="tab" onclick="switchTab(1)">‚ùì –í–æ–ø—Ä–æ—Å—ã</button>
            <button class="tab" onclick="switchTab(2)">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
            <button class="tab" onclick="switchTab(3)">üëÅÔ∏è –≠–∫—Å–ø–æ—Ä—Ç/Genially</button>
        </div>

        <div class="tab-content active">
            <div class="section">
                <h2 class="section-title">–¢–µ–º–∞ –∏ –û–∫—Ä—É–∂–µ–Ω–∏–µ</h2>
                <div class="theme-selector" id="themeSelector"></div>
            </div>
            </div>

        <div class="tab-content">
            <div class="section">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2 class="section-title">–í–æ–ø—Ä–æ—Å—ã</h2>
                    <button class="btn btn-success" onclick="addQuestion()">+ –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
                </div>
                <div id="questionsList"></div>
            </div>
        </div>

        <div class="tab-content">
            <div class="section">
                <h2 class="section-title">–†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ—Ç–æ–∫</h2>
                <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∫–æ–Ω–∫–∏ –Ω–∞ –Ω—É–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–µ.</p>
                <div class="map-editor" id="mapEditor"></div>
            </div>
        </div>

        <div class="tab-content">
            <div class="section">
                <h2 class="section-title">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Genially</h2>
                <p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ Genially —á–µ—Ä–µ–∑ <b>Insert -> Others</b>:</p>
                <div class="iframe-container" id="geniallyCode"></div>
                <button class="btn btn-secondary" style="margin-top:10px;" onclick="copyIframe()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
            </div>
            <div style="text-align: center;">
                <button class="btn btn-success" onclick="exportGame()" style="padding: 20px 40px;">üíæ –°–∫–∞—á–∞—Ç—å .html –∏–≥—Ä—É</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        var editorData = {
            theme: 'pirates',
            questions: [],
            mapPoints: []
        };

        const themes = [
            {id:'pirates', name:'–ü–∏—Ä–∞—Ç—ã', icon:'üè¥‚Äç‚ò†Ô∏è', img:'https://img.freepik.com/free-vector/treasure-map-background-design_23-2148616535.jpg'},
            {id:'space', name:'–ö–æ—Å–º–æ—Å', icon:'üöÄ', img:'https://img.freepik.com/free-vector/outer-space-background-with-planets_1308-80983.jpg'},
            {id:'jungle', name:'–î–∂—É–Ω–≥–ª–∏', icon:'üå¥', img:'https://img.freepik.com/free-vector/jungle-landscape-with-vines-illustration_1308-96944.jpg'},
            {id:'underwater', name:'–ú–æ—Ä—Å–∫–æ–µ –¥–Ω–æ', icon:'üê†', img:'https://img.freepik.com/free-vector/underwater-background-with-sea-weeds_1308-30514.jpg'},
            {id:'city', name:'–ì–æ—Ä–æ–¥', icon:'üèôÔ∏è', img:'https://img.freepik.com/free-vector/city-skyline-concept-illustration_114360-892.jpg'}
        ];

        function switchTab(index) {
            document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab')[index].classList.add('active');
            document.querySelectorAll('.tab-content')[index].classList.add('active');
            if(index === 3) generateGeniallyCode();
        }

        function renderThemes() {
            const container = document.getElementById('themeSelector');
            container.innerHTML = themes.map(t => `
                <div class="theme-card ${t.id === editorData.theme ? 'selected' : ''}" onclick="selectTheme('${t.id}')">
                    <div style="font-size:3em">${t.icon}</div>
                    <div>${t.name}</div>
                </div>
            `).join('');
        }

        function selectTheme(id) {
            editorData.theme = id;
            renderThemes();
            const theme = themes.find(t => t.id === id);
            document.getElementById('mapEditor').style.backgroundImage = `url('${theme.img}')`;
        }

        function addQuestion() {
            const q = {
                id: Date.now(),
                text: '–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å',
                answers: [{id: 1, text: '–û—Ç–≤–µ—Ç 1', correct: true}]
            };
            editorData.questions.push(q);
            renderQuestions();
            updateMapPoints();
        }

        function renderQuestions() {
            const container = document.getElementById('questionsList');
            container.innerHTML = editorData.questions.map((q, idx) => `
                <div class="section" style="background:white; border: 1px solid #ddd;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <b>–í–æ–ø—Ä–æ—Å ‚Ññ${idx+1}</b>
                        <button class="btn-danger" onclick="deleteQuestion(${q.id})">–£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
                    </div>
                    <input type="text" value="${q.text}" onchange="updateQText(${q.id}, this.value)" style="margin-bottom:10px;">
                    <div id="answers_${q.id}">
                        ${q.answers.map(a => `
                            <div class="answer-item">
                                <input type="radio" name="correct_${q.id}" ${a.correct?'checked':''} onchange="setCorrect(${q.id}, ${a.id})">
                                <input type="text" value="${a.text}" onchange="updateAText(${q.id}, ${a.id}, this.value)">
                                <button class="btn-danger" onclick="removeAnswer(${q.id}, ${a.id})">√ó</button>
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn btn-secondary" onclick="addAnswer(${q.id})">+ –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
                </div>
            `).join('');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤
        function addAnswer(qId) {
            const q = editorData.questions.find(q => q.id === qId);
            q.answers.push({id: Date.now(), text: '–ù–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç', correct: false});
            renderQuestions();
        }

        function removeAnswer(qId, aId) {
            const q = editorData.questions.find(q => q.id === qId);
            if(q.answers.length > 1) {
                q.answers = q.answers.filter(a => a.id !== aId);
                renderQuestions();
            }
        }

        function setCorrect(qId, aId) {
            const q = editorData.questions.find(q => q.id === qId);
            q.answers.forEach(a => a.correct = (a.id === aId));
        }

        function updateQText(id, val) { editorData.questions.find(q => q.id === id).text = val; }
        function updateAText(qId, aId, val) { 
            editorData.questions.find(q => q.id === qId).answers.find(a => a.id === aId).text = val; 
        }

        function deleteQuestion(id) {
            editorData.questions = editorData.questions.filter(q => q.id !== id);
            renderQuestions();
            updateMapPoints();
        }

        // –ö–ê–†–¢–ê –ò –ú–ê–†–ö–ï–†–´
        function updateMapPoints() {
            const map = document.getElementById('mapEditor');
            const count = editorData.questions.length;
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ—á–µ–∫ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏
            if (editorData.mapPoints.length < count) {
                for(let i=editorData.mapPoints.length; i<count; i++) {
                    editorData.mapPoints.push({id: i+1, x: 10 + (i*10)%80, y: 50});
                }
            }
            editorData.mapPoints = editorData.mapPoints.slice(0, count);

            map.innerHTML = editorData.mapPoints.map(p => `
                <div class="map-point-editor" id="point_${p.id}" style="left:${p.x}%; top:${p.y}%;" onmousedown="startDrag(event, ${p.id})">
                    <span class="map-point-number">${p.id}</span>
                    <svg viewBox="0 0 24 24" fill="#e74c3c" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0C7.58 0 4 3.58 4 8c0 5.25 7 13 8 14 1-1 8-8.75 8-14 0-4.42-3.58-8-8-8zm0 11c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/>
                    </svg>
                </div>
            `).join('');
        }

        let draggedId = null;
        function startDrag(e, id) {
            draggedId = id;
            document.onmousemove = (ev) => {
                const rect = document.getElementById('mapEditor').getBoundingClientRect();
                let x = ((ev.clientX - rect.left) / rect.width) * 100;
                let y = ((ev.clientY - rect.top) / rect.height) * 100;
                
                x = Math.max(2, Math.min(98, x));
                y = Math.max(5, Math.min(98, y));

                const p = editorData.mapPoints.find(p => p.id === draggedId);
                p.x = x; p.y = y;
                const el = document.getElementById(`point_${draggedId}`);
                el.style.left = x + '%';
                el.style.top = y + '%';
            };
            document.onmouseup = () => { document.onmousemove = null; };
        }

        // –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–û–î–ê –î–õ–Ø GENIALLY
        function generateGeniallyCode() {
            // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å URL –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥, –≥–¥–µ –ª–µ–∂–∏—Ç –≤–∞—à –ø–ª–µ–µ—Ä –∏–≥—Ä—ã
            const dummyUrl = "https://your-game-hosting.com/player.html?data=" + btoa(JSON.stringify(editorData));
            const iframe = `<iframe src="${dummyUrl}" width="800" height="600" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>`;
            document.getElementById('geniallyCode').innerText = iframe;
        }

        function copyIframe() {
            const text = document.getElementById('geniallyCode').innerText;
            navigator.clipboard.writeText(text);
            alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = () => {
            renderThemes();
            selectTheme('pirates');
            addQuestion();
        };
    </script>
</body>
</html>
