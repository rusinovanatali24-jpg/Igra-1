<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –∏–≥—Ä—ã "–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏" PRO</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 40px; text-align: center; }
        .tabs { display: flex; background: #f5f5f5; border-bottom: 2px solid #ddd; }
        .tab { flex: 1; padding: 20px; text-align: center; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: all 0.3s ease; border: none; background: transparent; color: #666; }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }
        .tab-content { padding: 40px; display: none; }
        .tab-content.active { display: block; }
        
        .section { margin-bottom: 30px; padding: 25px; background: #f9f9f9; border-radius: 12px; border-left: 5px solid #667eea; }
        .section-title { font-size: 1.4em; margin-bottom: 20px; color: #333; display: flex; align-items: center; gap: 10px; }
        
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #444; }
        input[type="text"], input[type="number"], select, textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; }
        
        .theme-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .theme-card { padding: 15px; border: 3px solid #eee; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; background: white; }
        .theme-card.selected { border-color: #667eea; background: #f0f4ff; transform: translateY(-3px); }
        
        .map-editor { position: relative; width: 100%; height: 600px; border: 4px solid #8b4513; border-radius: 15px; background-size: cover; background-position: center; overflow: hidden; background-color: #eee; }
        .map-point-editor { position: absolute; width: 44px; height: 44px; cursor: move; transform: translate(-50%, -100%); filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); z-index: 10; }
        .map-point-number { position: absolute; top: 8px; left: 50%; transform: translateX(-50%); color: white; font-weight: bold; font-size: 13px; z-index: 11; }

        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-success { background: #27ae60; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-primary { background: #667eea; color: white; }
        .btn-secondary { background: #ecf0f1; color: #2c3e50; border: 1px solid #bdc3c7; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }

        .answer-item { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; background: white; padding: 8px; border-radius: 8px; border: 1px solid #eee; }
        .iframe-container { background: #2d3436; color: #fab1a0; padding: 20px; border-radius: 10px; font-family: 'Courier New', monospace; font-size: 0.9em; margin-top: 15px; border-left: 4px solid #ff7675; line-height: 1.5; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ –†–µ–¥–∞–∫—Ç–æ—Ä "–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏"</h1>
            <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–≤–æ—é –∏–≥—Ä—É –¥–æ –º–µ–ª—å—á–∞–π—à–∏—Ö –¥–µ—Ç–∞–ª–µ–π</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="tab" onclick="switchTab(1)">‚ùì –í–æ–ø—Ä–æ—Å—ã</button>
            <button class="tab" onclick="switchTab(2)">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
            <button class="tab" onclick="switchTab(3)">üëÅÔ∏è –ü—Ä–µ–≤—å—é –∏ –ö–æ–¥</button>
        </div>

        <div class="tab-content active">
            <div class="section">
                <h2 class="section-title">–¢–µ–º–∞ –∏–≥—Ä—ã</h2>
                <div class="theme-selector" id="themeSelector"></div>
            </div>
            <div class="section">
                <h2 class="section-title">–ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å</h2>
                <div class="settings-grid">
                    <div class="form-group">
                        <label>–ü–æ–ø—ã—Ç–æ–∫ –Ω–∞ –≤–æ–ø—Ä–æ—Å</label>
                        <select id="maxAttempts">
                            <option value="1">1 –ø–æ–ø—ã—Ç–∫–∞</option>
                            <option value="3" selected>3 –ø–æ–ø—ã—Ç–∫–∏</option>
                            <option value="999">–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–¢–∞–π–º–µ—Ä (—Å–µ–∫)</label>
                        <select id="timerDuration">
                            <option value="0">–ë–µ–∑ —Ç–∞–π–º–µ—Ä–∞</option>
                            <option value="30" selected>30 —Å–µ–∫—É–Ω–¥</option>
                            <option value="60">60 —Å–µ–∫—É–Ω–¥</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–ë–∞–ª–ª–æ–≤ –∑–∞ –æ—Ç–≤–µ—Ç</label>
                        <input type="number" id="pointsPerQuestion" value="10">
                    </div>
                    <div class="form-group">
                        <label>–ü–æ–¥—Å–∫–∞–∑–∫–∏ 50/50</label>
                        <input type="number" id="hintsAvailable" value="2">
                    </div>
                </div>
            </div>
            <div class="section">
                <h2 class="section-title">–§–∏–Ω–∞–ª</h2>
                <div class="settings-grid">
                    <div class="form-group">
                        <label>–ù–∞–≥—Ä–∞–¥–∞</label>
                        <select id="finalReward">
                            <option value="treasure">üè¥‚Äç‚ò†Ô∏è –°—É–Ω–¥—É–∫</option>
                            <option value="medal">üèÖ –ú–µ–¥–∞–ª—å</option>
                            <option value="cup">üèÜ –ö—É–±–æ–∫</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–¢–µ–∫—Å—Ç –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è</label>
                        <input type="text" id="finalMessage" value="–í—ã –Ω–∞—à–ª–∏ –≤—Å–µ —Å–æ–∫—Ä–æ–≤–∏—â–∞!">
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content">
            <div class="section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 class="section-title" style="margin:0;">–°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤</h2>
                    <button class="btn btn-success" onclick="addQuestion()">‚ú® –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
                </div>
                <div id="questionsList"></div>
            </div>
        </div>

        <div class="tab-content">
            <div class="section">
                <h2 class="section-title">–§–æ–Ω –∫–∞—Ä—Ç—ã</h2>
                <div style="display:flex; gap:15px; margin-bottom:20px; align-items: center;">
                    <button class="btn btn-primary" onclick="document.getElementById('mapUpload').click()">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ—é –∫–∞—Ä—Ç—É</button>
                    <input type="file" id="mapUpload" hidden accept="image/*" onchange="handleMapUpload(this)">
                    <span style="color:#666; font-size:0.9em;">–∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö</span>
                </div>
                <div class="map-editor" id="mapEditor"></div>
            </div>
        </div>

        <div class="tab-content">
            <div class="section">
                <h2 class="section-title">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Genially</h2>
                <p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ Genially (Insert -> Others):</p>
                <div class="iframe-container" id="geniallyCode"></div>
                <button class="btn btn-primary" style="margin-top:15px;" onclick="copyIframe()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
            </div>
            <div style="text-align: center;">
                <button class="btn btn-success" onclick="exportGame()" style="padding: 15px 40px; font-size: 1.2em;">üíæ –°–∫–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤—É—é –∏–≥—Ä—É (.html)</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        var editorData = {
            theme: 'pirates',
            customMap: null,
            questions: []
        };

        const themes = [
            {id:'pirates', name:'–ü–∏—Ä–∞—Ç—ã', icon:'üè¥‚Äç‚ò†Ô∏è', img:'https://img.freepik.com/free-vector/treasure-map-background-design_23-2148616535.jpg'},
            {id:'space', name:'–ö–æ—Å–º–æ—Å', icon:'üöÄ', img:'https://img.freepik.com/free-vector/outer-space-background-with-planets_1308-80983.jpg'},
            {id:'jungle', name:'–î–∂—É–Ω–≥–ª–∏', icon:'üå¥', img:'https://img.freepik.com/free-vector/jungle-landscape-with-vines-illustration_1308-96944.jpg'},
            {id:'underwater', name:'–ú–æ—Ä—Å–∫–æ–µ –¥–Ω–æ', icon:'üê†', img:'https://img.freepik.com/free-vector/underwater-background-with-sea-weeds_1308-30514.jpg'},
            {id:'city', name:'–ì–æ—Ä–æ–¥', icon:'üèôÔ∏è', img:'https://img.freepik.com/free-vector/city-skyline-concept-illustration_114360-892.jpg'}
        ];

        function switchTab(index) {
            document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab')[index].classList.add('active');
            document.querySelectorAll('.tab-content')[index].classList.add('active');
            if(index === 2) updateMapPoints();
            if(index === 3) generateGeniallyCode();
        }

        function renderThemes() {
            const container = document.getElementById('themeSelector');
            container.innerHTML = themes.map(t => `
                <div class="theme-card ${t.id === editorData.theme ? 'selected' : ''}" onclick="selectTheme('${t.id}')">
                    <div style="font-size:2.5em; margin-bottom:5px;">${t.icon}</div>
                    <div style="font-weight:bold;">${t.name}</div>
                </div>
            `).join('');
        }

        function selectTheme(id) {
            editorData.theme = id;
            editorData.customMap = null;
            renderThemes();
            const theme = themes.find(t => t.id === id);
            document.getElementById('mapEditor').style.backgroundImage = `url('${theme.img}')`;
        }

        function handleMapUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    editorData.customMap = e.target.result;
                    document.getElementById('mapEditor').style.backgroundImage = `url('${e.target.result}')`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function addQuestion() {
            const q = {
                id: Date.now(),
                type: 'single', // single, multiple, text
                text: '',
                answers: [{id: 1, text: '', correct: true}],
                mapPoint: {x: 50, y: 50}
            };
            editorData.questions.push(q);
            renderQuestions();
        }

        function renderQuestions() {
            const container = document.getElementById('questionsList');
            container.innerHTML = editorData.questions.map((q, idx) => `
                <div class="section" style="background:white; border: 1px solid #eee; border-left-color: #667eea;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <span style="background:#667eea; color:white; padding:4px 12px; border-radius:20px; font-weight:bold;">–í–æ–ø—Ä–æ—Å ${idx+1}</span>
                        <button class="btn btn-danger" onclick="deleteQuestion(${q.id})" style="padding:5px 10px;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    
                    <div class="form-group">
                        <label>–¢–∏–ø –≤–æ–ø—Ä–æ—Å–∞</label>
                        <select onchange="updateQType(${q.id}, this.value)">
                            <option value="single" ${q.type==='single'?'selected':''}>–û–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</option>
                            <option value="multiple" ${q.type==='multiple'?'selected':''}>–ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</option>
                            <option value="text" ${q.type==='text'?'selected':''}>–í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞</label>
                        <input type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–∫–æ–ª—å–∫–æ –ø–ª–∞–Ω–µ—Ç –≤ –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ?" value="${q.text}" onchange="updateQText(${q.id}, this.value)">
                    </div>

                    <div id="answers_container_${q.id}">
                        ${q.type === 'text' ? `
                            <div class="form-group">
                                <label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</label>
                                <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç..." value="${q.answers[0].text}" onchange="updateAText(${q.id}, ${q.answers[0].id}, this.value)">
                            </div>
                        ` : `
                            <label style="font-size:0.9em; font-weight:bold; display:block; margin-bottom:10px;">–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤:</label>
                            ${q.answers.map(a => `
                                <div class="answer-item">
                                    <input type="${q.type==='single'?'radio':'checkbox'}" name="correct_${q.id}" ${a.correct?'checked':''} onchange="toggleCorrect(${q.id}, ${a.id})">
                                    <input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞" value="${a.text}" onchange="updateAText(${q.id}, ${a.id}, this.value)">
                                    <button class="btn btn-secondary" onclick="removeAnswer(${q.id}, ${a.id})" style="color:red; border:none;">‚úï</button>
                                </div>
                            `).join('')}
                            <button class="btn btn-secondary" onclick="addAnswer(${q.id})" style="width:100%; margin-top:5px; border-style:dashed;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
                        `}
                    </div>
                </div>
            `).join('');
        }

        function updateQType(id, type) {
            const q = editorData.questions.find(q => q.id === id);
            q.type = type;
            if(type === 'text') q.answers = [{id: 1, text: '', correct: true}];
            renderQuestions();
        }

        function addAnswer(qId) {
            const q = editorData.questions.find(q => q.id === qId);
            q.answers.push({id: Date.now(), text: '', correct: false});
            renderQuestions();
        }

        function removeAnswer(qId, aId) {
            const q = editorData.questions.find(q => q.id === qId);
            if(q.answers.length > 1) {
                q.answers = q.answers.filter(a => a.id !== aId);
                renderQuestions();
            }
        }

        function toggleCorrect(qId, aId) {
            const q = editorData.questions.find(q => q.id === qId);
            if(q.type === 'single') {
                q.answers.forEach(a => a.correct = (a.id === aId));
            } else {
                const a = q.answers.find(a => a.id === aId);
                a.correct = !a.correct;
            }
        }

        function updateQText(id, val) { editorData.questions.find(q => q.id === id).text = val; }
        function updateAText(qId, aId, val) { 
            editorData.questions.find(q => q.id === qId).answers.find(a => a.id === aId).text = val; 
        }

        function deleteQuestion(id) {
            editorData.questions = editorData.questions.filter(q => q.id !== id);
            renderQuestions();
        }

        function updateMapPoints() {
            const map = document.getElementById('mapEditor');
            map.innerHTML = editorData.questions.map((q, idx) => `
                <div class="map-point-editor" id="point_${q.id}" style="left:${q.mapPoint.x}%; top:${q.mapPoint.y}%;" onmousedown="startDrag(event, ${q.id})">
                    <span class="map-point-number">${idx+1}</span>
                    <svg viewBox="0 0 24 24" fill="#e74c3c" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0C7.58 0 4 3.58 4 8c0 5.25 7 13 8 14 1-1 8-8.75 8-14 0-4.42-3.58-8-8-8zm0 11c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/>
                    </svg>
                </div>
            `).join('');
        }

        function startDrag(e, id) {
            const q = editorData.questions.find(q => q.id === id);
            const rect = document.getElementById('mapEditor').getBoundingClientRect();
            document.onmousemove = (ev) => {
                let x = ((ev.clientX - rect.left) / rect.width) * 100;
                let y = ((ev.clientY - rect.top) / rect.height) * 100;
                q.mapPoint.x = Math.max(2, Math.min(98, x));
                q.mapPoint.y = Math.max(5, Math.min(98, y));
                const el = document.getElementById(`point_${id}`);
                el.style.left = q.mapPoint.x + '%';
                el.style.top = q.mapPoint.y + '%';
            };
            document.onmouseup = () => document.onmousemove = null;
        }

        function generateGeniallyCode() {
            const gameData = btoa(unescape(encodeURIComponent(JSON.stringify(editorData))));
            const url = "https://your-hosting.com/game-player.html?d=" + gameData;
            document.getElementById('geniallyCode').innerText = `<iframe src="${url}" width="100%" height="600" frameborder="0" allowfullscreen="true"></iframe>`;
        }

        function copyIframe() {
            navigator.clipboard.writeText(document.getElementById('geniallyCode').innerText);
            alert("–ö–æ–¥ –¥–ª—è Genially —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
        }

        window.onload = () => {
            renderThemes();
            selectTheme('pirates');
            addQuestion();
        };
    </script>
</body>
</html>
