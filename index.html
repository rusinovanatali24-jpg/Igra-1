<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –∏–≥—Ä—ã "–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏" PRO</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 40px; text-align: center; }
        .tabs { display: flex; background: #f5f5f5; border-bottom: 2px solid #ddd; }
        .tab { flex: 1; padding: 20px; text-align: center; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: all 0.3s ease; border: none; background: transparent; color: #666; }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }
        .tab-content { padding: 40px; display: none; }
        .tab-content.active { display: block; }
        
        .section { margin-bottom: 30px; padding: 25px; background: #f9f9f9; border-radius: 12px; border-left: 5px solid #667eea; }
        .section-title { font-size: 1.4em; margin-bottom: 20px; color: #333; display: flex; align-items: center; gap: 10px; }
        
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; }

        /* –ò–∫–æ–Ω–∫–∏ —Ç–µ–º */
        .theme-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; }
        .theme-card { padding: 15px; border: 3px solid #eee; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; background: white; }
        .theme-card.selected { border-color: #667eea; background: #f0f4ff; transform: scale(1.05); }

        /* –ö–∞—Ä—Ç–∞ –∏ –ú–µ—Ç–∫–∏-–≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏ */
        .map-editor { position: relative; width: 100%; height: 600px; border: 4px solid #8b4513; border-radius: 15px; background-size: cover; background-position: center; background-color: #ddd; box-shadow: inset 0 0 30px rgba(0,0,0,0.2); }
        .map-point-editor { position: absolute; width: 44px; height: 44px; cursor: move; transform: translate(-50%, -100%); filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); z-index: 100; }
        .map-point-number { position: absolute; top: 8px; left: 50%; transform: translateX(-50%); color: white; font-weight: bold; font-size: 13px; z-index: 101; text-shadow: 1px 1px 2px black; }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-success { background: #27ae60; color: white; }
        .btn-primary { background: #667eea; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-secondary { background: #eee; color: #333; }

        /* –î–∏–∑–∞–π–Ω –í–æ–ø—Ä–æ—Å–æ–≤ (–í–æ–∑–≤—Ä–∞—â–µ–Ω) */
        .answer-item { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; background: white; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
        .iframe-container { background: #2d3436; color: #fab1a0; padding: 20px; border-radius: 10px; font-family: monospace; overflow-x: auto; margin-top: 15px; border-left: 4px solid #ff7675; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ –†–µ–¥–∞–∫—Ç–æ—Ä "–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏"</h1>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="tab" onclick="switchTab(1)">‚ùì –í–æ–ø—Ä–æ—Å—ã</button>
            <button class="tab" onclick="switchTab(2)">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
            <button class="tab" onclick="switchTab(3)">üëÅÔ∏è –ü—Ä–µ–≤—å—é</button>
        </div>

        <div class="tab-content active">
            <div class="section">
                <h2 class="section-title">–¢–µ–º–∞ –∏–≥—Ä—ã</h2>
                <div class="theme-selector" id="themeSelector"></div>
            </div>
            <div class="section">
                <h2 class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
                <div class="settings-grid">
                    <div class="form-group"><label>–ü–æ–ø—ã—Ç–æ–∫ –Ω–∞ –≤–æ–ø—Ä–æ—Å</label><select id="maxAttempts"><option value="3">3 –ø–æ–ø—ã—Ç–∫–∏</option><option value="999">‚àû –ë–µ–∑–ª–∏–º–∏—Ç</option></select></div>
                    <div class="form-group"><label>–¢–∞–π–º–µ—Ä (—Å–µ–∫)</label><input type="number" id="timerDuration" value="30"></div>
                    <div class="form-group"><label>–ë–∞–ª–ª—ã –∑–∞ –≤–æ–ø—Ä–æ—Å</label><input type="number" id="pointsPerQuestion" value="10"></div>
                </div>
            </div>
            <div class="section">
                <h2 class="section-title">–§–∏–Ω–∞–ª –∏ –ù–∞–≥—Ä–∞–¥–∞</h2>
                <div class="settings-grid">
                    <div class="form-group">
                        <label>–¢–∏–ø –Ω–∞–≥—Ä–∞–¥—ã</label>
                        <select id="finalReward">
                            <option value="treasure">üè¥‚Äç‚ò†Ô∏è –°—É–Ω–¥—É–∫</option>
                            <option value="medal">üèÖ –ú–µ–¥–∞–ª—å</option>
                            <option value="trophy">üèÜ –ö—É–±–æ–∫</option>
                            <option value="crystal">üíé –ö—Ä–∏—Å—Ç–∞–ª–ª</option>
                        </select>
                    </div>
                    <div class="form-group"><label>–¢–µ–∫—Å—Ç –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è</label><input type="text" id="finalMessage" value="–í—ã –Ω–∞—à–ª–∏ –≤—Å–µ —Å–æ–∫—Ä–æ–≤–∏—â–∞!"></div>
                </div>
            </div>
        </div>

        <div class="tab-content">
            <div class="section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 class="section-title">–°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤</h2>
                    <button class="btn btn-success" onclick="addQuestion()">‚ú® –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
                </div>
                <div id="questionsList"></div>
            </div>
        </div>

        <div class="tab-content">
            <div class="section">
                <h2 class="section-title">–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–µ</h2>
                <div style="margin-bottom:15px; display:flex; gap:10px;">
                    <button class="btn btn-primary" onclick="document.getElementById('mapUpload').click()">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ—é –∫–∞—Ä—Ç—É</button>
                    <input type="file" id="mapUpload" hidden accept="image/*" onchange="handleMapUpload(event)">
                </div>
                <div class="map-editor" id="mapEditor"></div>
            </div>
        </div>

        <div class="tab-content">
            <div class="section">
                <h2 class="section-title">–ö–æ–¥ –¥–ª—è Genially</h2>
                <p>–í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –±–ª–æ–∫ "–í—Å—Ç–∞–≤–∏—Ç—å -> –î—Ä—É–≥–æ–µ":</p>
                <div class="iframe-container" id="geniallyCode"></div>
                <button class="btn btn-primary" style="margin-top:15px;" onclick="copyIframe()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
            </div>
            <div style="text-align:center; padding-top:20px;">
                <button class="btn btn-success" onclick="exportGame()" style="padding: 15px 50px; font-size: 1.2em;">üíæ –°–∫–∞—á–∞—Ç—å –∏–≥—Ä—É (.html)</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        var editorData = {
            theme: 'pirates',
            customMap: null,
            questions: []
        };

        const themes = [
            {id:'pirates', name:'–ü–∏—Ä–∞—Ç—ã', icon:'üè¥‚Äç‚ò†Ô∏è', img:'https://raw.githubusercontent.com/fshv-dev/treasure-assets/main/pirates_map.jpg'},
            {id:'space', name:'–ö–æ—Å–º–æ—Å', icon:'üöÄ', img:'https://raw.githubusercontent.com/fshv-dev/treasure-assets/main/space_map.jpg'},
            {id:'jungle', name:'–î–∂—É–Ω–≥–ª–∏', icon:'üå¥', img:'https://raw.githubusercontent.com/fshv-dev/treasure-assets/main/jungle_map.jpg'},
            {id:'underwater', name:'–ú–æ—Ä–µ', icon:'üê†', img:'https://raw.githubusercontent.com/fshv-dev/treasure-assets/main/underwater_map.jpg'},
            {id:'city', name:'–ì–æ—Ä–æ–¥', icon:'üèôÔ∏è', img:'https://img.freepik.com/free-vector/city-skyline-concept-illustration_114360-892.jpg'}
        ];

        function switchTab(idx) {
            document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab')[idx].classList.add('active');
            document.querySelectorAll('.tab-content')[idx].classList.add('active');
            if(idx === 2) renderMapPoints();
            if(idx === 3) generateGeniallyCode();
        }

        function renderThemes() {
            const container = document.getElementById('themeSelector');
            container.innerHTML = themes.map(t => `
                <div class="theme-card ${t.id === editorData.theme ? 'selected' : ''}" onclick="selectTheme('${t.id}')">
                    <div style="font-size:2.8em; margin-bottom:5px;">${t.icon}</div>
                    <div style="font-weight:bold">${t.name}</div>
                </div>
            `).join('');
        }

        function selectTheme(id) {
            editorData.theme = id;
            editorData.customMap = null;
            renderThemes();
            updateMapDisplay();
        }

        function updateMapDisplay() {
            const map = document.getElementById('mapEditor');
            if(editorData.customMap) {
                map.style.backgroundImage = `url('${editorData.customMap}')`;
            } else {
                const theme = themes.find(t => t.id === editorData.theme);
                map.style.backgroundImage = `url('${theme.img}')`;
            }
        }

        function handleMapUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    editorData.customMap = e.target.result;
                    updateMapDisplay();
                };
                reader.readAsDataURL(file);
            }
        }

        // --- –õ–û–ì–ò–ö–ê –í–û–ü–†–û–°–û–í (–í–û–ó–í–†–ê–©–ï–ù–ê) ---
        function addQuestion() {
            const q = { 
                id: Date.now(), 
                text: '', 
                type: 'single', 
                answers: [{id: 1, text: '', correct: true}],
                x: 50, y: 50 
            };
            editorData.questions.push(q);
            renderQuestions();
        }

        function renderQuestions() {
            const container = document.getElementById('questionsList');
            container.innerHTML = editorData.questions.map((q, idx) => `
                <div class="section" style="background:white; border: 1px solid #eee; border-left-color:#667eea;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <span style="background:#667eea; color:white; padding:4px 12px; border-radius:20px; font-weight:bold;">–í–æ–ø—Ä–æ—Å ${idx+1}</span>
                        <button class="btn-danger" onclick="deleteQuestion(${q.id})" style="padding:5px 10px; border-radius:6px;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    
                    <div class="form-group">
                        <label>–¢–∏–ø –≤–æ–ø—Ä–æ—Å–∞</label>
                        <select onchange="updateQType(${q.id}, this.value)">
                            <option value="single" ${q.type==='single'?'selected':''}>–û–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</option>
                            <option value="multiple" ${q.type==='multiple'?'selected':''}>–ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</option>
                            <option value="text" ${q.type==='text'?'selected':''}>–í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞</label>
                        <input type="text" value="${q.text}" onchange="updateQText(${q.id}, this.value)" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å...">
                    </div>

                    <div id="ans_box_${q.id}">
                        ${q.type === 'text' ? `
                            <input type="text" value="${q.answers[0].text}" onchange="updateAText(${q.id}, ${q.answers[0].id}, this.value)" placeholder="–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç...">
                        ` : `
                            ${q.answers.map(a => `
                                <div class="answer-item">
                                    <input type="${q.type==='single'?'radio':'checkbox'}" name="q_${q.id}" ${a.correct?'checked':''} onchange="toggleCorrect(${q.id}, ${a.id})">
                                    <input type="text" value="${a.text}" onchange="updateAText(${q.id}, ${a.id}, this.value)" placeholder="–í–∞—Ä–∏–∞–Ω—Ç...">
                                    <button class="btn-secondary" onclick="removeAns(${q.id}, ${a.id})" style="border:none; color:red;">‚úï</button>
                                </div>
                            `).join('')}
                            <button class="btn btn-secondary" onclick="addAns(${q.id})" style="width:100%; border:1px dashed #ccc;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
                        `}
                    </div>
                </div>
            `).join('');
        }

        function updateQType(id, type) {
            const q = editorData.questions.find(q=>q.id===id);
            q.type = type;
            if(type === 'text') q.answers = [{id: 1, text: '', correct: true}];
            renderQuestions();
        }
        function updateQText(id, val) { editorData.questions.find(q=>q.id===id).text = val; }
        function updateAText(qId, aId, val) { editorData.questions.find(q=>q.id===qId).answers.find(a=>a.id===aId).text = val; }
        function toggleCorrect(qId, aId) {
            const q = editorData.questions.find(q=>q.id===qId);
            if(q.type==='single') q.answers.forEach(a => a.correct = (a.id === aId));
            else q.answers.find(a=>a.id===aId).correct = !q.answers.find(a=>a.id===aId).correct;
        }
        function addAns(qId) { editorData.questions.find(q=>q.id===qId).answers.push({id:Date.now(), text:'', correct:false}); renderQuestions(); }
        function removeAns(qId, aId) { 
            const q = editorData.questions.find(q=>q.id===qId);
            if(q.answers.length > 1) { q.answers = q.answers.filter(a=>a.id!==aId); renderQuestions(); }
        }
        function deleteQuestion(id) { editorData.questions = editorData.questions.filter(q=>q.id!==id); renderQuestions(); }

        // --- –ö–ê–†–¢–ê (–ú–ê–†–ö–ï–†–´ –ì–ï–û–ü–û–ó–ò–¶–ò–ò) ---
        function renderMapPoints() {
            const map = document.getElementById('mapEditor');
            map.innerHTML = editorData.questions.map((q, idx) => `
                <div class="map-point-editor" id="pt_${q.id}" style="left:${q.x}%; top:${q.y}%;" onmousedown="startDrag(event, ${q.id})">
                    <span class="map-point-number">${idx+1}</span>
                    <svg viewBox="0 0 24 24" fill="#e74c3c" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0C7.58 0 4 3.58 4 8c0 5.25 7 13 8 14 1-1 8-8.75 8-14 0-4.42-3.58-8-8-8zm0 11c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/>
                    </svg>
                </div>
            `).join('');
        }

        function startDrag(e, id) {
            const rect = document.getElementById('mapEditor').getBoundingClientRect();
            const q = editorData.questions.find(q=>q.id===id);
            document.onmousemove = (ev) => {
                let x = ((ev.clientX - rect.left) / rect.width) * 100;
                let y = ((ev.clientY - rect.top) / rect.height) * 100;
                q.x = Math.max(2, Math.min(98, x));
                q.y = Math.max(5, Math.min(98, y));
                const el = document.getElementById(`pt_${id}`);
                el.style.left = q.x + '%'; el.style.top = q.y + '%';
            };
            document.onmouseup = () => document.onmousemove = null;
        }

        // --- –≠–ö–°–ü–û–†–¢ ---
        function generateGeniallyCode() {
            const url = "https://your-hosting.com/play?data=" + btoa(unescape(encodeURIComponent(JSON.stringify(editorData))));
            document.getElementById('geniallyCode').innerText = `<iframe src="${url}" width="100%" height="600" frameborder="0" allowfullscreen="true"></iframe>`;
        }

        function copyIframe() {
            navigator.clipboard.writeText(document.getElementById('geniallyCode').innerText);
            alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
        }

        function exportGame() {
            const html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>–ò–≥—Ä–∞</title></head><body>
            <script>const gameData = ${JSON.stringify(editorData)};<\/script>
            <div id="game-root"></div>
            <script src="https://your-hosting.com/engine.js"><\/script></body></html>`;
            const blob = new Blob([html], {type: "text/html;charset=utf-8"});
            saveAs(blob, "treasure-hunt-game.html");
        }

        window.onload = () => { renderThemes(); selectTheme('pirates'); addQuestion(); };
    </script>
</body>
</html>
